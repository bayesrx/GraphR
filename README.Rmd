---
output: github_document
#output: html_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# GraphR overview

<center><img src="GraphR_Method_plot_final.png" width="600" height="600" ></center>

The GraphR (Graphical Regression) is a flexible approach which incorporates sample heterogenity and enables covariate-dependent graphs. Our regression-based method provides a functional mapping from the covariate space to precision matrix for different types of heterogeneous graphical model settings. GraphR imposes sparsity in both edge and covariate selection and computationally efficient via use of variational Bayes algorithms. The method is versatile to incorporate different type of covariates such as <br>
(I) **binary** (control and disease specific graphs), <br>
(II) **categorical** (category specific graphs such as cancer subtypes), <br>
(III) **univariate continuous** (time varying graphs for single cell data), <br>
(IV) **categorical + univariate continuous** (graphs changing over category such as cancer sub-types and continuous scale as biomarkers), <br> 
(V) **multivariate continuous** (spatial transcriptomics co-expression networks). <br>
GraphR is implemented as an open-source R package.


## Installation

You can install the released version of GraphR from (https://github.com/bayesrx/GraphR) with:

``` {r , eval=FALSE}
devtools::install_github("bayesrx/GraphR")
library(GraphR)
```

## Example 
An example code with one of the existing datasets to demonstrate how to run the functions and obtain inference.

The **GraphR_est** can be used for estimation. The inputs of estimation of function include features (nodes) and external covariates which are $n \times p$ and $n \times q$ matrix respectively. Please note that our function doesn't provide standardization of features and external covariates, and thus **please standardize features and external covariates before plugging into the function**. It is suggested to maintain $n/pq >1$ and efficacy of the method increase with high values of $n/pq$ ratio. For priors, we assume $\pi \sim Beta(a_\pi, b_\pi)$ and $\tau \sim \Gamma(a_\tau, b_\tau)$. **GraphR_est** function returns a list containing <br>
(1) the coefficient (Beta), <br>
(2) posterior inclusion probability (PIP) of external covaraites and <br>
(3) diagonal elements of precision matrix.


We also provide prediction function **GraphR_pred** which requires a new matrix based on which prediction are made and the output of **GraphR_est** function. Optionally, one can also enter the the coefficient (Beta) and posterior inclusion probability (PIP) of external covaraites, and diagonal elements of precision matrix obtained from other functions as the input. The output contains following information: <br>
(1) Corresponding external covariates values, <br> 
(2) Indices of features, <br> 
(3) Partial correlations between two features and PIPs of edges and, <br>
(4) Bayesian FDR-adjusted p-values.


```{r}
set.seed(100)
library(GraphR)
library(dplyr)
data("Pam50")

features <- apply(Pam50$features,2,scale) %>% as.matrix()
features[c(1:5),c(1:5)]

external <- Pam50$external %>% as.matrix()
external[c(1:5),]


system.time(res <- GraphR_est(
  features,
  external,
  a_pi = 1,
  b_pi = 4,
  a_tau = 0.005,
  b_tau = 0.005,
  max_iter = 2000,
  max_tol = 0.001
))

####### prediction
new_df <- diag(3)
colnames(new_df) <- colnames(external)

system.time(pred <- GraphR_pred(new_df, res))
head(pred)
```


## Shiny App 
(link to the Shiny App tab only)

## Tutorial website
(link to the tutorial website)

## Paper 
(Link to the paper) 

## Supplementary file 
(link to the bookdown file)
